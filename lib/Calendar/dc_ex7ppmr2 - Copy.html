<!DOCTYPE html>
<html lang="en">

  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/dc.css" />
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">

  <!-- Semantic UI CSS -->
  <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.css" /> -->
  <!-- <script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous"></script> -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

  <!-- Bootstrap CSS -->
  <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<style>
/* html *
{
   font-size: 1.0em !important;
} */
  .heat-box {
    stroke: #E6E6E6;
    stroke-width: 2px;
  }
  /* .cols {
    fill:green;
    font: 50px;
    font-size:500px
  } */
  .dc-chart g.row text {
  fill: black;
  font-size: 12px;
}

.aspectwrapper {
  display: inline-block; /* shrink to fit */
  width: 100%;           /* whatever width you like */
  position: relative;    /* so .content can use position: absolute */
}
.aspectwrapper::after {
  padding-top: 56.25%; /* percentage of containing block _width_ */
  display: block;
  content: '';
}
.content {
  position: absolute;
  top: 0; bottom: 0; right: 0; left: 0;  /* follow the parent's edges */
  outline: thin dashed green;            /* just so you can see the box */
}

  /* .dc-chart text {
    fill: red;
  } */
</style>
<style>
#heat-chart  {font-size: 14px; font-weight: normal;margin-top: 20px; padding-left: 10px;}
#heat-chart22  {font-size: 14px; font-weight: normal;margin-top: 20px; padding-left: 10px;}
#legend_div  {font-size: 14px; font-weight: normal;margin-top: 20px; margin-left:430px;}

     /* #heat-chart { padding-left: 100px; font-size: 14px; font-weight: normal; float: right;margin-top: 20px } */
     #heat-chart-axis { padding-left: 10px; font-size: 12px; font-weight: normal; float: right;margin-top: 20px }
     #line-chart {   padding-left: 10px; font-size: 12px; font-weight: normal; float: right; }
     #strong_char {   position: absolute; left: 130px; font-size: 12px; font-weight: normal; margin-bottom: 20px; /* or whatever */ }
   #button_char {   position: relative; left: 100px; font-size: 12px; font-weight: normal; float: left;  /* or whatever */ }
     /* #button_char2 {   position: absolute; right: 130px; font-size: 12px; font-weight: normal; float: right; top:250px /* or whatever */ } */
</style>

<body  style="overflow-x: auto;font-family: 'Roboto', sans-serif">
  <div class="w3-container w3-padding-12 w3-light-grey w3-center w3-small" style="position:inherit;top:0px;width:100%;margin: 0;padding:0;display:block">
    <!-- <img src="../other/stickeroid_5bf57b51e9f17.png" style="width:8%;display: block;margin:auto"> -->
      <h2 style="font-family: 'Roboto', sans-serif;font-size:20px">Warehouse ADVISER - Global
      <div id="button_char">
        <Button type="button" class="btn btn-inverse" onclick="window.location.href = '../../home_page.html'">
          <i class="fas fa-home"></i>
        </Button>
      </div>
    </h2>
    <!-- <p>Powered by <a href="https://www.chemonics.com/" target="_blank" class="w3-hover-text-green">SC-FACT</a><i class="fa fa-ambulance w3-hover-opacity"></i></p> -->
  </div>



    <!-- <div id="button_char2">
<Button type="button" class="btn btn-primary" OnClick="javascript:heatChart.filterAll();dc.redrawAll();">
<i class="fas fa-undo"></i>
</Button>
</div> -->


    <div class="svg-container" id="heat-chart" style="overflow-y: scroll;height:450px;" >
      <!-- <a class="reset" href="javascript:heatChart.filterAll();dc.redrawAll();" style="display: none;">reset</a> -->
      <!-- <div class="clearfix"></div> -->
    </div>


  <div class="svg-container" id="heat-chart22" >

<svg width="1700" height="20">
  <g class="heatmap" transform="translate(430,20)">
  <g class="cols axis">
    <text x="47" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Botswana</text>
    <text x="131" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Burundi</text>
    <text x="215" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Cameroon</text>
    <text x="299" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Cote d'Ivoire</text>
    <text x="383" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">DRC</text>
    <text x="467" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Ghana</text>
    <text x="551" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Haiti</text>
    <text x="635" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Lesotho</text>
    <text x="719" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Malawi</text>
      <text x="803" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Mozambique</text>
      <text x="887" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Namibia</text>
      <text x="971" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Nigeria</text>
      <text x="1055" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Rwanda</text>
      <text x="1139" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Zambia</text>
      <text x="1223" style="text-anchor: middle;font-size:16px;" y="5960" dy="12" transform="translate(0, -5973.5 )">Zimbabwe</text>
  </g>
</g>
</svg>
</div>
<div id="legend_div">

  <svg id="legend" left: 400px height=150 width=1000></svg>
</div>

<!-- <div class='test_class'> -->
  <!-- <div class="svg-container" id="heat-chart22"> -->



    <!-- <div id="heat-chart-axis">

      <div class="clearfix"></div>
    </div> -->


    <!-- <div id="line-chart">
      <div class="ui divider"></div>
      <strong>Line Chart</strong> ()
      <a class="reset" href="javascript:lineChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

      <div class="clearfix"></div>
    </div>
    <div class="clearfix"></div> -->
    <!-- <div>
        <a href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
    </div> -->
  <!-- </div> -->



  <script type="text/javascript" src="js/promise-polyfill.js"></script>
  <script type="text/javascript" src="js/fetch.umd.js"></script>
  <script type="text/javascript" src="js/d3.js"></script>
  <script type="text/javascript" src="js/crossfilter.js"></script>
  <script type="text/javascript" src="js/dc.js"></script>


  <script type="text/javascript">

  function loadPage(d){

// new_loc = "file:///C:/Users/HarrisIqbal/Documents/WareHouse_Adviser%20Tool/lib/Calendar/dc_ex7ppmr2.html?id="+d
window.location.href =  '../BINA_compchart_may17/line_may15.html?id='+d[0]+'&id2='+d[1]
  };

function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    console.log('Query variable %s not found', variable);
}
// console.log(JSON.stringify(window.location.pathname))
// console.log(getQueryVariable(JSON.stringify(window.location.pathname)))

// if (getQueryVariable("id") == null){
//   console.log('yes')
// } else {
//   console.log('no')
// }

var clicked_var = getQueryVariable("id")
console.log(clicked_var)





    var heatChart = dc.heatMap("#heat-chart");

    var data;
    d3.csv("Master_File.5.csv").then(function(csv) {


      // csv = csv.filter(function(d) { return d["Period"] === "2018-02"}) // Filtering
      csv.sort(function(a, b) {
        return new Date(a.Period).getTime() - new Date(b.Period).getTime()
      });



      data = crossfilter(csv);








      heatrunDim = data.dimension(function(d) {
          return [d.Country, d.Product, d.Date, d.MOS];
        }),
        heatrunGroup = heatrunDim.group().reduceSum(function(d) {
          return [Math.round(d.MOS)];
        });


      var colorsDomain = [0.1, 3, 6];
      var colorss2 = ["#e34a33", "#f4a582", "#dddddd", "#72bad4"];
      console.log('hello')
console.log($(window).width())
console.log($(window).height())

      heatChart.width(1700)
        .height(6000)
        .margins({
          left: 430,
          top: 20,
          right: 0,
          bottom: 20
        })
        .dimension(heatrunDim)
        .group(heatrunGroup)
        .ordering(function(d) { return d.key[1]; })
        .keyAccessor(function(d) {
          return d.key[0];
        })
        .valueAccessor(function(d) {
          return d.key[1];
        })
        .colorAccessor(function(d) {
          return d.key[2];
        })

        .title(function(d) {
          // console.log(d);
          return "Country:   " + d.key[0] + "\n" +
            "Product:  " + d.key[1] + "\n" +
            "Date:  " + d.key[2] + "\n" +
            "MOS: " + Math.round(d.key[3]);
        })
        .on('renderlet.label', function(chart) {
          var text = chart.selectAll('g.box-group')
            .selectAll('text.annotate').data(d => [d]);
          text.exit().remove();
          // enter attributes => anything that won't change
          var textEnter = text.enter()
            .append('text')
            .attr('class', 'annotate')
            .attr('fill','black')
          textEnter.selectAll('tspan')
            .data(d => [d.value,'  ',d.key[0]])
            .enter().append('tspan')
            .attr('text-anchor', 'middle')
            .attr('dy', 10);
          text = textEnter.merge(text);
          // update attributes => position and text
          text
            .attr('y', function() {
              var rect = d3.select(this.parentNode).select('rect');
              return +rect.attr('y') + rect.attr('height') / 2 - 15;
            });
          text.selectAll('tspan')
            .attr('x', function() {
              var rect = d3.select(this.parentNode.parentNode).select('rect');
              return +rect.attr('x') + rect.attr('width') / 2;
            })
            .text(d => d);
        })


        .on('pretransition.axis', function(chart) {
          chart.selectAll("g.cols.axis text")
            .attr("transform", function() {
              var coord = this.getBBox();
              var x = coord.x + (coord.width / 2) + 20
              y = coord.y + (coord.height / 2) + 20;
              y = -y + 15
              return "translate(0, " + y + " )"

            })
            .attr("style", function() {
              return "text-anchor: middle;font-size:16px;font-family:Roboto, sans-serif"
            })
            chart.selectAll("g.rows.axis text")
            .attr("style", function() {
              return "text-anchor: end;font-size:16px;font-family:Roboto, sans-serif"
            })
        })

        .colors(d3.scaleThreshold().domain(colorsDomain).range(colorss2))
        .colorAccessor(function(d) {
          return d.value;
        })
        .on("renderlet", function(chart) {
  chart.selectAll('rect').on("click", function(d) {
    var empt = []
    var send_click = JSON.stringify(d.key[0])
    var send_click2 = JSON.stringify(d.key[1])
    empt.push(send_click)
    empt.push(send_click2)

    console.log(empt)
    loadPage(empt);
  });
});


      // -------------------------------------------------


      console.log('kk')
      // var clone = heatChart.selectAll("g.cols.axis text")._parents[0]
      // console.log(clone)


  // var button = heatChart.selectAll("g.cols.axis text").clone();
  // console.log(button.innerHTML)
  // console.log(button)
//   ('.package').html($button);
// });



// $(function(){
//     $('.svg-container').clone().appendTo($('#heat-chart22 '));
// });




      dc.renderAll();



    });



  </script>

  <script>


// select the svg area
var svg = d3.select("#legend")

// Handmade legend"#e34a33", "#f4a582", "#dddddd", "#72bad4"
svg.append("circle").attr("cx",20).attr("cy",54).attr("r", 6).style("fill", "#e34a33")
svg.append("circle").attr("cx",160).attr("cy",54).attr("r", 6).style("fill", "#f4a582")
svg.append("circle").attr("cx",340).attr("cy",54).attr("r", 6).style("fill", "#dddddd")
svg.append("circle").attr("cx",520).attr("cy",54).attr("r", 6).style("fill", "#72bad4")


svg.append("text").attr("x", 40).attr("y", 60).text("Stockout (0)").style("font-size", "15px").attr("alignment-baseline","middle")
svg.append("text").attr("x", 180).attr("y", 60).text("Near Stockout (<3)").style("font-size", "15px").attr("alignment-baseline","middle")
svg.append("text").attr("x", 360).attr("y", 60).text("Adequate (3 - 6)").style("font-size", "15px").attr("alignment-baseline","middle")
svg.append("text").attr("x", 540).attr("y", 60).text("Overstock (>6)").style("font-size", "15px").attr("alignment-baseline","middle")

</script>


</body>

</html>
